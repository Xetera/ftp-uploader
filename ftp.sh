#!/usr/bin/env bash

source $(dirname "$0")/config.sh

clipboard=$(xclip -o -selection clipboard -t image/png 2> /dev/null)

if [[ "target image/png not available" == *"$clipboard"* ]]; then
  echo "No image found on clipboard!"
  exit 1
fi

emojis=(ðŸ˜€ ðŸ˜ ðŸ˜‚ ðŸ¤£ ðŸ˜ƒ ðŸ˜„ ðŸ˜… ðŸ˜† ðŸ˜‰ ðŸ˜Š ðŸ˜‹ ðŸ˜Ž ðŸ˜ ðŸ˜˜ ðŸ¥° ðŸ˜— ðŸ˜™ ðŸ˜š â˜º ðŸ™‚ ðŸ¤— ðŸ¤© ðŸ¤” ðŸ¤¨ ðŸ˜ ðŸ˜‘ ðŸ˜¶ ðŸ™„ ðŸ˜ ðŸ˜£ ðŸ˜¥ ðŸ˜® ðŸ¤ ðŸ˜¯ ðŸ˜ª ðŸ˜« ðŸ˜´ ðŸ˜Œ ðŸ˜› ðŸ˜œ ðŸ˜ ðŸ¤¤ ðŸ˜’ ðŸ˜“ ðŸ˜” ðŸ˜• ðŸ™ƒ ðŸ¤‘ ðŸ˜² â˜¹ ðŸ™ ðŸ˜– ðŸ˜ž ðŸ˜Ÿ ðŸ˜¤ ðŸ˜¢ ðŸ˜­ ðŸ˜¦ ðŸ˜§ ðŸ˜¨ ðŸ˜© ðŸ¤¯ ðŸ˜¬ ðŸ˜° ðŸ˜± ðŸ¥µ ðŸ¥¶ ðŸ˜³ ðŸ¤ª ðŸ˜µ ðŸ˜¡ ðŸ˜  ðŸ¤¬ ðŸ˜· ðŸ¤’ ðŸ¤• ðŸ¤¢ ðŸ¤® ðŸ¤§ ðŸ˜‡ ðŸ¤  ðŸ¤¡ ðŸ¥³ ðŸ¥´ ðŸ¥º ðŸ¤¥ ðŸ¤« ðŸ¤­ ðŸ§ ðŸ¤“ ðŸ˜ˆ ðŸ‘¿ ðŸ‘¹ ðŸ‘º ðŸ’€ â˜  ðŸ‘» ðŸ‘½ ðŸ‘¾ ðŸ¤– ðŸ’© ðŸ˜º ðŸ˜¸ ðŸ˜¹ ðŸ˜» ðŸ˜¼ ðŸ˜½ ðŸ™€ ðŸ˜¿ ðŸ˜¾ ðŸ‘¶ ðŸ‘¦ ðŸ‘§ ðŸ‘¨ ðŸ‘© ðŸ‘´ ðŸ‘µ ðŸ‘® ðŸ•µ ðŸ’‚ ðŸ‘· ðŸ¤´ ðŸ‘¸ ðŸ‘³ ðŸ‘² ðŸ§• ðŸ§” ðŸ‘± ðŸ¤µ ðŸ‘° ðŸ¤° ðŸ¤± ðŸ‘¼ ðŸŽ… ðŸ¤¶ ðŸ¦¸ ðŸ¦¹ ðŸ§™ ðŸ§› ðŸ§œ ðŸ§ ðŸ§ž ðŸ§Ÿ ðŸ™ ðŸ™Ž ðŸ™… ðŸ™† ðŸ’ ðŸ™‹ ðŸ™‡ ðŸ¤¦ ðŸ¤· ðŸ’† ðŸ’‡ ðŸš¶ ðŸƒ ðŸ’ƒ ðŸ•º ðŸ‘¯ ðŸ§– ðŸ§˜ ðŸ•´ ðŸ—£ ðŸ‘¤ ðŸ‘¥ ðŸ‘« ðŸ‘¬ ðŸ‘­ ðŸ’ ðŸ’‘ ðŸ‘ª ðŸ¤³ ðŸ’ª ðŸ¦µ ðŸ¦¶ ðŸ‘ˆ ðŸ‘‰ â˜ ðŸ‘† ðŸ–• ðŸ‘‡ âœŒ ðŸ¤ž ðŸ–– ðŸ¤˜ ðŸ¤™ ðŸ– âœ‹ ðŸ‘Œ ðŸ‘ ðŸ‘Ž âœŠ ðŸ‘Š ðŸ¤› ðŸ¤œ ðŸ¤š ðŸ‘‹ ðŸ¤Ÿ âœ ðŸ‘ ðŸ‘ ðŸ™Œ ðŸ¤² ðŸ™ ðŸ¤ ðŸ’… ðŸ‘‚ ðŸ‘ƒ ðŸ‘£ ðŸ‘€ ðŸ‘ ðŸ§  ðŸ¦´ ðŸ¦· ðŸ‘… ðŸ‘„ ðŸ’‹ ðŸ‘“ ðŸ•¶ ðŸ¥½ ðŸ¥¼ ðŸ‘” ðŸ‘• ðŸ‘– ðŸ§£ ðŸ§¤ ðŸ§¥ ðŸ§¦ ðŸ‘— ðŸ‘˜ ðŸ‘™ ðŸ‘š ðŸ‘› ðŸ‘œ ðŸ‘ ðŸŽ’ ðŸ‘ž ðŸ‘Ÿ ðŸ¥¾ ðŸ¥¿ ðŸ‘  ðŸ‘¡ ðŸ‘¢ ðŸ‘‘ ðŸ‘’ ðŸŽ© ðŸŽ“ ðŸ§¢ â›‘ ðŸ’„ ðŸ’ ðŸ§³ ðŸŒ‚ â˜‚ ðŸ’¼ ðŸ§µ ðŸ§¶)

name=""

if [[ "$@" == *"-e"* ]]; then
  i=0
  while [ "$i" -le 5 ]; do
    index=$(($RANDOM % 256))
    name="$name${emojis[index]}"
    i=$(($i + 1))
  done
else 
  name=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w $FILE_NAME_LENGTH | head -n 1)
fi

xclip -o -selection clipboard -t image/png -o > "$name.png"

ftp -n "$HOST" <<END_SCRIPT
  quote USER "$USERNAME"
  quote PASS "$PASSWORD"
  passive
  binary
  put "$name.png"
END_SCRIPT

rm "$name.png"

url="$BASE_REDIRECT_URL/$name.png"

echo -n $url | xclip -i -selection clipboard

if [[ "$@" != *"-q"* ]]; then
  echo "$url"
fi

if [[ "$@" == *"-w"* ]]; then
  xdg-open "$url"
fi
